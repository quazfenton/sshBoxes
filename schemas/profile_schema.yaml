# Profile Configuration Schema

Profiles define the capabilities and constraints for different types of sshBox instances.

## Schema Definition

```yaml
type: object
title: "sshBox Profile Configuration"
required:
  - name
  - description
  - image
  - cpu_limit
  - memory_limit
  - ttl_default
  - capabilities
  - network_policy

properties:
  name:
    type: string
    description: "Profile identifier"
    enum: ["dev", "debug", "secure-shell", "privileged"]
  
  description:
    type: string
    description: "Human-readable description of the profile"
  
  image:
    type: string
    description: "Base image to use for this profile"
  
  cpu_limit:
    type: string
    description: "CPU limit (e.g., '1', '2', '0.5')"
  
  memory_limit:
    type: string
    description: "Memory limit (e.g., '1Gi', '2Gi')"
  
  ttl_default:
    type: integer
    description: "Default time-to-live in seconds"
  
  ttl_max:
    type: integer
    description: "Maximum allowed TTL in seconds"
  
  capabilities:
    type: array
    items:
      type: string
    description: "List of allowed capabilities"
  
  network_policy:
    type: object
    properties:
      egress_allowed:
        type: array
        items:
          type: string
        description: "List of allowed outbound destinations"
      egress_blocked:
        type: array
        items:
          type: string
        description: "List of blocked outbound destinations"
      internet_access:
        type: boolean
        description: "Whether internet access is allowed"
    
  volume_mounts:
    type: array
    items:
      type: object
      properties:
        path:
          type: string
          description: "Mount path in container"
        type:
          type: string
          enum: ["tmpfs", "bind", "volume"]
        source:
          type: string
          description: "Source path (for bind mounts)"
        readonly:
          type: boolean
          description: "Whether mount is read-only"
  
  allowed_commands:
    type: array
    items:
      type: string
    description: "List of allowed commands (whitelist)"
  
  forbidden_commands:
    type: array
    items:
      type: string
    description: "List of forbidden commands (blacklist)"
```

## Example Profiles

### Dev Profile
```yaml
name: "dev"
description: "Development environment with basic tools and internet access"
image: "sshbox-dev:latest"
cpu_limit: "1"
memory_limit: "2Gi"
ttl_default: 1800  # 30 minutes
ttl_max: 3600       # 1 hour
capabilities:
  - "NET_ADMIN"
  - "SYS_PTRACE"
network_policy:
  internet_access: true
  egress_allowed:
    - "github.com:443"
    - "pypi.org:443"
    - "registry.npmjs.org:443"
volume_mounts: []
allowed_commands: []
forbidden_commands: []
```

### Debug Profile
```yaml
name: "debug"
description: "Debugging environment with cloud CLIs and kubectl"
image: "sshbox-debug:latest"
cpu_limit: "1"
memory_limit: "2Gi"
ttl_default: 3600  # 1 hour
ttl_max: 7200      # 2 hours
capabilities:
  - "NET_ADMIN"
  - "SYS_PTRACE"
network_policy:
  internet_access: true
  egress_allowed:
    - "kubernetes.default.svc.cluster.local:443"
    - "*.aws.amazon.com:443"
    - "*.googleapis.com:443"
    - "*.azure.com:443"
volume_mounts: []
allowed_commands:
  - "kubectl"
  - "aws"
  - "gcloud"
  - "az"
  - "helm"
  - "docker"
forbidden_commands: []
```

### Secure Shell Profile
```yaml
name: "secure-shell"
description: "Fully isolated environment with no network access"
image: "sshbox-secure:latest"
cpu_limit: "0.5"
memory_limit: "1Gi"
ttl_default: 600   # 10 minutes
ttl_max: 1800      # 30 minutes
capabilities: []
network_policy:
  internet_access: false
  egress_allowed: []
  egress_blocked:
    - "*"
volume_mounts:
  - path: "/tmp"
    type: "tmpfs"
    readonly: false
allowed_commands: []
forbidden_commands:
  - "curl"
  - "wget"
  - "ping"
  - "netstat"
  - "ifconfig"
```

### Privileged Profile (Staff Only)
```yaml
name: "privileged"
description: "High-privilege environment for staff (requires approval)"
image: "sshbox-privileged:latest"
cpu_limit: "2"
memory_limit: "4Gi"
ttl_default: 1800  # 30 minutes
ttl_max: 3600      # 1 hour
capabilities:
  - "NET_ADMIN"
  - "SYS_ADMIN"
  - "SYS_PTRACE"
  - "DAC_READ_SEARCH"
  - "SETUID"
  - "SETGID"
network_policy:
  internet_access: true
  egress_allowed: ["*"]
volume_mounts: []
allowed_commands: []
forbidden_commands: []
```